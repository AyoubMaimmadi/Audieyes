name: Check build, code style, and tests

on:
    workflow_dispatch:
    pull_request:
    # push:

jobs:
    lintandformat:
        name: ğŸ§¹ Audieyes Linting & Testing
        runs-on: ubuntu-latest
        timeout-minutes: 5
        env:
            CI: false
        steps:
            - name: ğŸ›’ Checkout
              uses: actions/checkout@v2
            - name: ğŸŸ© Use Node 18.x
              uses: actions/setup-node@v1
              with:
                  node-version: '18.x'
            - name: ğŸ“¦ Install dependencies for server
              run: cd Audieyes/app/server && npm i
            - name: ğŸ“¦ Install dependencies for model
              run: pip install -r requirements.txt
            - name: ğŸ§ª Run tests
              run: |
                  python3 -m pytest Audieyes/zemML/tests/checkpoints_tests.py
                  python3 -m pytest Audieyes/zemML/tests/metrics_tests.py
    train_evaluate_deploy:
        needs: lintandformat
        runs-on: ubuntu-latest
        steps:
            - name: ğŸ›’ Checkout code
              uses: actions/checkout@v2
            - name: ğŸ“¦ Install dependencies for model
              run: pip install -r requirements.txt
            - name: ğŸš‚ Train model
              run: python3 Audieyes/zemML/pipelines/src/data/train_model.py
            - name: ğŸ” Evaluate model
              run: python3 Audieyes/zemML/pipelines/src/data/evaluate_model.py
            - name: ğŸš€ Deploy model
              if: success()
              run: python3 Audieyes/zemML/pipelines/src/data/deploy_model.py
